@prefix : <http://example.org/austrian-tax-resident#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@base <http://example.org/austrian-tax-resident> .

<http://example.org/austrian-tax-resident> rdf:type owl:Ontology ;
                                          rdfs:label "Austrian Tax Residents Income Tax Ontology"@en ;
                                          rdfs:comment """A comprehensive OWL 2 ontology for determining income tax filing obligations for Austrian tax residents.

This ontology implements the Austrian Income Tax Act (Einkommensteuergesetz - EStG) provisions for resident taxpayers, 
providing automated reasoning capabilities to determine filing requirements based on income types and amounts.

SCOPE: Austrian tax residents only (persons with unlimited tax liability under §1 EStG)
- Wage income (§25 EStG - employment income subject to payroll tax)
- Other income sources (self-employment, rental, investment, etc.)
- Filing thresholds and requirements for tax year 2025
- Automated classification of taxpayer categories

VERSION: 2.1 (Fixed Consistency Issues)
"""@en ;
                                          owl:versionInfo "2.1" .

#################################################################
#    Annotation Properties
#################################################################

dc:creator rdf:type owl:AnnotationProperty .
dc:subject rdf:type owl:AnnotationProperty .
dcterms:license rdf:type owl:AnnotationProperty .
dcterms:created rdf:type owl:AnnotationProperty .
dcterms:modified rdf:type owl:AnnotationProperty .

:legalBasis rdf:type owl:AnnotationProperty ;
           rdfs:label "legal basis"@en ;
           rdfs:comment "Reference to specific Austrian tax law provisions."@en .

:taxYearApplicable rdf:type owl:AnnotationProperty ;
                  rdfs:label "tax year applicable"@en ;
                  rdfs:comment "Tax year(s) for which this rule applies."@en .

:thresholdAmount rdf:type owl:AnnotationProperty ;
                rdfs:label "threshold amount"@en ;
                rdfs:comment "Specific monetary threshold in EUR for 2025."@en .

#################################################################
#    Data Properties
#################################################################

### Primary Income Properties

:hasAnnualWageIncome rdf:type owl:DatatypeProperty ;
                     rdfs:domain :AustrianResident ;
                     rdfs:range xsd:decimal ;
                     rdfs:label "has annual wage income"@en ;
                     rdfs:comment "Total annual wage/pension income subject to payroll tax withholding under §25 EStG."@en .

:hasNonWageIncome rdf:type owl:DatatypeProperty ;
                  rdfs:domain :AustrianResident ;
                  rdfs:range xsd:decimal ;
                  rdfs:label "has non-wage income"@en ;
                  rdfs:comment "Total annual non-wage income (self-employment, rental, investment, etc.)."@en .

### Employment Characteristics

:hasFiledEmploymentTax rdf:type owl:DatatypeProperty ;
                      rdfs:domain :AustrianResident ;
                      rdfs:range xsd:boolean ;
                      rdfs:label "has filed employment tax"@en ;
                      rdfs:comment "Indicates if wage tax was filed for the employment income."@en .

:hasMultipleEmploymentsWithoutJointTax rdf:type owl:DatatypeProperty ;
                        rdfs:domain :AustrianResident ;
                        rdfs:range xsd:boolean ;
                        rdfs:label "has multiple employments without joint tax"@en ;
                        rdfs:comment "Indicates whether the taxpayer has simultaneous employment relationships with multiple employers, without joint tax assessment."@en .

### Administrative Properties

:hasIncorrectTaxCredits rdf:type owl:DatatypeProperty ;
                        rdfs:domain :AustrianResident ;
                        rdfs:range xsd:boolean ;
                        rdfs:label "has incorrect tax credits"@en ;
                        rdfs:comment "Indicates if tax credits were incorrectly applied in salary calculation."@en .

:hasSpecialPaymentSituations rdf:type owl:DatatypeProperty ;
                            rdfs:domain :AustrianResident ;
                            rdfs:range xsd:boolean ;
                            rdfs:label "has special payment situations"@en ;
                            rdfs:comment "Indicates receipt of sick pay, armed forces payments, service vouchers, etc."@en .

:hasVaryingIncomeLevels rdf:type owl:DatatypeProperty ;
                        rdfs:domain :AustrianResident ;
                        rdfs:range xsd:boolean ;
                        rdfs:label "has varying income levels"@en ;
                        rdfs:comment "Indicates if employee received different levels of income during the year."@en .

:hasUnclaimedDeductions rdf:type owl:DatatypeProperty ;
                       rdfs:domain :AustrianResident ;
                       rdfs:range xsd:boolean ;
                       rdfs:label "has unclaimed deductions"@en ;
                       rdfs:comment "Indicates presence of unclaimed income-related expenses, special expenses, or extraordinary burdens."@en .

:hasIncorrectCommuterAllowance rdf:type owl:DatatypeProperty ;
                               rdfs:domain :AustrianResident ;
                               rdfs:range xsd:boolean ;
                               rdfs:label "has incorrect commuter allowance"@en ;
                               rdfs:comment "Indicates if a lump sum for commuters was incorrectly applied."@en .

:hasIncorrectFamilyBonus rdf:type owl:DatatypeProperty ;
                         rdfs:domain :AustrianResident ;
                         rdfs:range xsd:boolean ;
                         rdfs:label "has incorrect family bonus"@en ;
                         rdfs:comment "Indicates if Family Bonus Plus conditions were not met."@en .

:hasDiscretionaryAssessment rdf:type owl:DatatypeProperty ;
                            rdfs:domain :AustrianResident ;
                            rdfs:range xsd:boolean ;
                            rdfs:label "has discretionary assessment"@en ;
                            rdfs:comment "Indicates if a discretionary assessment was included in salary calculation."@en .

:hasEmployerChange rdf:type owl:DatatypeProperty ;
                   rdfs:domain :AustrianResident ;
                   rdfs:range xsd:boolean ;
                   rdfs:label "has employer change"@en ;
                   rdfs:comment "Indicates if employee changed employer or was not employed for whole year."@en .

:hasSVRepaymentEligibility rdf:type owl:DatatypeProperty ;
                           rdfs:domain :AustrianResident ;
                           rdfs:range xsd:boolean ;
                           rdfs:label "has SV repayment eligibility"@en ;
                           rdfs:comment "Indicates eligibility for SV repayment due to low pay."@en .

# Add new data properties for voluntary filing conditions
:hasSingleEmployer rdf:type owl:DatatypeProperty ;
                   rdfs:domain :AustrianResident ;
                   rdfs:range xsd:boolean ;
                   rdfs:label "has single employer"@en ;
                   rdfs:comment "Indicates if employee has income solely from a single employer."@en .

:hasCorrectWageTax rdf:type owl:DatatypeProperty ;
                   rdfs:domain :AustrianResident ;
                   rdfs:range xsd:boolean ;
                   rdfs:label "has correct wage tax"@en ;
                   rdfs:comment "Indicates if wage tax was correctly withheld."@en .

:hasVaryingIncomeNoRollup rdf:type owl:DatatypeProperty ;
                          rdfs:domain :AustrianResident ;
                          rdfs:range xsd:boolean ;
                          rdfs:label "has varying income without rollup"@en ;
                          rdfs:comment "Indicates if employee received different levels of income without rolling-up process."@en .

:hasUnclaimedTaxCredits rdf:type owl:DatatypeProperty ;
                        rdfs:domain :AustrianResident ;
                        rdfs:range xsd:boolean ;
                        rdfs:label "has unclaimed tax credits"@en ;
                        rdfs:comment "Indicates if entitled to unclaimed single-earner/single-parent tax credit or commuter allowance."@en .                                                 

#################################################################
#    Classes
#################################################################

### Base Taxpayer Class

:AustrianResident rdf:type owl:Class ;
                  rdfs:label "Austrian Tax Resident"@en ;
                  rdfs:comment "A person subject to unlimited tax liability in Austria under §1 EStG."@en .

### Filing Requirement Categories

:MandatoryL1Filer rdf:type owl:Class ;
                  rdfs:label "Mandatory Filing with form L1"@en ;
                  rdfs:comment """Taxpayers legally required to file L1 tax return under Austrian law.
                  Required when:
                  - Annual wage over 14,517 AND specific conditions are met
                  - Tax credits or deductions incorrectly applied
                  - Multiple simultaneous wage incomes
                  - Special payment situations"""@en .

:VoluntaryL1Filer rdf:type owl:Class ;
                  rdfs:label "Voluntary Filing with form L1"@en ;
                  rdfs:comment """Taxpayers who may benefit from voluntary filing with L1 form.
                  Applicable for:
                  - Single employer with correct wage tax withholding
                  - Varying income levels without rolling-up
                  - Employer changes or partial year employment
                  - Low income SV repayment eligibility
                  - Unclaimed tax credits or deductions"""@en .

:MandatoryE1Filer rdf:type owl:Class ;
                  rdfs:label "Mandatory Filing with form E1"@en ;
                  rdfs:comment """Taxpayers required to file E1 tax return.
                  Required when:
                  - Additional non-employment income exceeds EUR 730
                  - Excludes fully taxed capital yields"""@en .

#################################################################
# Priority hierarchy:
# MandatoryE1Filer > MandatoryL1Filer > VoluntaryL1Filer
#################################################################

# Declare disjointness
DisjointClasses(
    :MandatoryE1Filer
    :MandatoryL1Filer
    :VoluntaryL1Filer
)

#################################################################
# Mandatory E1 Filing Rule (highest priority)
#################################################################
:MandatoryE1Filer owl:equivalentClass [
    rdf:type owl:Class ;
    owl:intersectionOf (
        :AustrianResident
        [ rdf:type owl:Restriction ;
          owl:onProperty :hasNonWageIncome ;
          owl:someValuesFrom [ rdf:type rdfs:Datatype ;
                               owl:onDatatype xsd:decimal ;
                               owl:withRestrictions (
                                 [ xsd:minExclusive "730.0"^^xsd:decimal ]
                               ) ] ]
    )
] .

#################################################################
# Mandatory L1 Filing Rule (only if NOT E1)
#################################################################
:MandatoryL1Filer owl:equivalentClass [
    rdf:type owl:Class ;
    owl:intersectionOf (
        :AustrianResident
        [ rdf:type owl:Class ; owl:complementOf :MandatoryE1Filer ]
        [ owl:unionOf (
            # Main case: Wage > 14,517 AND (any of the three triggers)
            [ owl:intersectionOf (
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasAnnualWageIncome ;
                  owl:someValuesFrom [ rdf:type rdfs:Datatype ;
                                       owl:onDatatype xsd:decimal ;
                                       owl:withRestrictions (
                                         [ xsd:minExclusive "14517.0"^^xsd:decimal ]
                                       ) ] ]
                [ owl:unionOf (
                    [ rdf:type owl:Restriction ;
                      owl:onProperty :hasMultipleEmploymentsWithoutJointTax ;
                      owl:hasValue true ]
                    [ rdf:type owl:Restriction ;
                      owl:onProperty :hasIncorrectCommuterAllowance ;
                      owl:hasValue true ]
                    [ rdf:type owl:Restriction ;
                      owl:onProperty :hasIncorrectFamilyBonus ;
                      owl:hasValue true ]
                ) ]
            ) ]
            # Wage income above threshold but employment tax NOT filed
            [ owl:intersectionOf (
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasAnnualWageIncome ;
                  owl:someValuesFrom [ rdf:type rdfs:Datatype ;
                                       owl:onDatatype xsd:decimal ;
                                       owl:withRestrictions (
                                         [ xsd:minInclusive "13308.0"^^xsd:decimal ]
                                       ) ] ]
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasFiledEmploymentTax ;
                  owl:hasValue false ]
            ) ]
            # Special payment situations
            [ rdf:type owl:Restriction ;
              owl:onProperty :hasSpecialPaymentSituations ;
              owl:hasValue true ]
            # Discretionary assessment
            [ rdf:type owl:Restriction ;
              owl:onProperty :hasDiscretionaryAssessment ;
              owl:hasValue true ]
            # Incorrect tax credits
            [ rdf:type owl:Restriction ;
              owl:onProperty :hasIncorrectTaxCredits ;
              owl:hasValue true ]
        ) ]
    )
] .

#################################################################
# Voluntary L1 Filing Rule (only if NOT E1 and NOT L1 mandatory)
#################################################################
:VoluntaryL1Filer owl:equivalentClass [
    rdf:type owl:Class ;
    owl:intersectionOf (
        :AustrianResident
        [ rdf:type owl:Class ; owl:complementOf :MandatoryE1Filer ]
        [ rdf:type owl:Class ; owl:complementOf :MandatoryL1Filer ]
        [ owl:unionOf (
            # Case 1: Single employer with correct wage tax
            [ owl:intersectionOf (
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasSingleEmployer ;
                  owl:hasValue true ]
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasCorrectWageTax ;
                  owl:hasValue true ]
            ) ]
            # Case 2: Tax refund conditions (any of these)
            [ owl:unionOf (
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasVaryingIncomeNoRollup ;
                  owl:hasValue true ]
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasEmployerChange ;
                  owl:hasValue true ]
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasSVRepaymentEligibility ;
                  owl:hasValue true ]
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasUnclaimedTaxCredits ;
                  owl:hasValue true ]
                [ rdf:type owl:Restriction ;
                  owl:onProperty :hasUnclaimedDeductions ;
                  owl:hasValue true ]
            ) ]
        ) ]
    )
] .

#################################################################
#    Test Cases
#################################################################

### Test Case 1: Mandatory L1 - High Income with Incorrect Tax Credits
:TestCase_MandatoryL1_HighIncome rdf:type :AustrianResident ;
                                rdfs:label "Test: Mandatory L1 - High Income with Incorrect Credits"@en ;
                                :hasAnnualWageIncome "35000.0"^^xsd:decimal ;
                                :hasNonWageIncome "0.0"^^xsd:decimal ;
                                :hasIncorrectTaxCredits true .

### Test Case 2: Mandatory L1 - Wage above 14,517 with Multiple Employers
:TestCase_MandatoryL1_MultipleEmployers rdf:type :AustrianResident ;
                                       rdfs:label "Test: Mandatory L1 - Multiple Employers"@en ;
                                       :hasAnnualWageIncome "20000.0"^^xsd:decimal ;
                                       :hasNonWageIncome "0.0"^^xsd:decimal ;
                                       :hasMultipleEmploymentsWithoutJointTax true .

### Test Case 3: Mandatory L1 - Special Payment Situations
:TestCase_MandatoryL1_SpecialPayments rdf:type :AustrianResident ;
                                      rdfs:label "Test: Mandatory L1 - Special Payment Situations"@en ;
                                      :hasAnnualWageIncome "16000.0"^^xsd:decimal ;
                                      :hasSpecialPaymentSituations true .

### Test Case 4: Mandatory L1 - Discretionary Assessment
:TestCase_MandatoryL1_Discretionary rdf:type :AustrianResident ;
                                    rdfs:label "Test: Mandatory L1 - Discretionary Assessment"@en ;
                                    :hasAnnualWageIncome "18000.0"^^xsd:decimal ;
                                    :hasDiscretionaryAssessment true .

### Test Case 5: Mandatory L1 - Wage > 13,308 but No Employment Tax Filed
:TestCase_MandatoryL1_NoEmploymentTax rdf:type :AustrianResident ;
                                      rdfs:label "Test: Mandatory L1 - No Employment Tax Filed"@en ;
                                      :hasAnnualWageIncome "14000.0"^^xsd:decimal ;
                                      :hasFiledEmploymentTax false .

### Test Case 6: Mandatory E1 - Non-Wage Income > 730
:TestCase_MandatoryE1_HighNonWage rdf:type :AustrianResident ;
                                  rdfs:label "Test: Mandatory E1 - High Non-Wage Income"@en ;
                                  :hasAnnualWageIncome "10000.0"^^xsd:decimal ;
                                  :hasNonWageIncome "5000.0"^^xsd:decimal .

### Test Case 7: Mandatory E1 - Both Wage and Non-Wage
:TestCase_MandatoryE1_WageAndNonWage rdf:type :AustrianResident ;
                                     rdfs:label "Test: Mandatory E1 - Wage + Non-Wage"@en ;
                                     :hasAnnualWageIncome "20000.0"^^xsd:decimal ;
                                     :hasNonWageIncome "1000.0"^^xsd:decimal ;
                                     :hasIncorrectTaxCredits true ;
                                     :hasMultipleEmploymentsWithoutJointTax true .
# Expected: Classified as MandatoryE1 (overrides L1)

### Test Case 8: Voluntary L1 - Single Employer with Correct Wage Tax
:TestCase_VoluntaryL1_SingleEmployer rdf:type :AustrianResident ;
                                     rdfs:label "Test: Voluntary L1 - Single Employer Correct Tax"@en ;
                                     :hasAnnualWageIncome "20000.0"^^xsd:decimal ;
                                     :hasNonWageIncome "0.0"^^xsd:decimal ;
                                     :hasSingleEmployer true ;
                                     :hasCorrectWageTax true .

### Test Case 9: Voluntary L1 - Employer Change
:TestCase_VoluntaryL1_EmployerChange rdf:type :AustrianResident ;
                                     rdfs:label "Test: Voluntary L1 - Employer Change"@en ;
                                     :hasAnnualWageIncome "15000.0"^^xsd:decimal ;
                                     :hasEmployerChange true .

### Test Case 10: Voluntary L1 - Varying Income, No Rollup
:TestCase_VoluntaryL1_VaryingIncome rdf:type :AustrianResident ;
                                    rdfs:label "Test: Voluntary L1 - Varying Income Without Rollup"@en ;
                                    :hasAnnualWageIncome "12000.0"^^xsd:decimal ;
                                    :hasVaryingIncomeNoRollup true .

### Test Case 11: Voluntary L1 - SV Repayment Eligibility
:TestCase_VoluntaryL1_SVRepayment rdf:type :AustrianResident ;
                                  rdfs:label "Test: Voluntary L1 - SV Repayment"@en ;
                                  :hasAnnualWageIncome "8000.0"^^xsd:decimal ;
                                  :hasSVRepaymentEligibility true .

### Test Case 12: Voluntary L1 - Unclaimed Deductions
:TestCase_VoluntaryL1_UnclaimedDeductions rdf:type :AustrianResident ;
                                          rdfs:label "Test: Voluntary L1 - Unclaimed Deductions"@en ;
                                          :hasAnnualWageIncome "10000.0"^^xsd:decimal ;
                                          :hasUnclaimedDeductions true .

### Test Case 13: Voluntary L1 - Low Income Single Employer
:TestCase_VoluntaryL1_LowIncome rdf:type :AustrianResident ;
                               rdfs:label "Test: Voluntary L1 - Low Income Single Employer"@en ;
                               rdfs:comment "Expected: Classified as VoluntaryL1 (single employer with correct tax)"@en ;
                               :hasAnnualWageIncome "5000.0"^^xsd:decimal ;
                               :hasNonWageIncome "0.0"^^xsd:decimal ;
                               :hasSingleEmployer true ;
                               :hasCorrectWageTax true .
                               
### Use Case 1: Voluntary L1 - Special Expenses
:TestCase_VoluntaryL1_SpecialExpenses rdf:type :AustrianResident ;
    rdfs:label "Test: Voluntary L1 - Special Expenses"@en ;
    rdfs:comment "A secretary with a single employer can file voluntarily to claim special expenses for a tax refund."@en ;
    :hasAnnualWageIncome "32000.0"^^xsd:decimal ;
    :hasNonWageIncome "0.0"^^xsd:decimal ;
    :hasSingleEmployer true ;
    :hasCorrectWageTax true ;
    :hasUnclaimedDeductions true .

### Use Case 2: Mandatory E1 - Employment and Non-Wage Income
:TestCase_MandatoryE1_Employment_NonWage rdf:type :AustrianResident ;
    rdfs:label "Test: Mandatory E1 - Employment and Non-Wage Income"@en ;
    rdfs:comment "Austrian resident with employment income and non-wage income above €730." ;
    :hasAnnualWageIncome "25000.0"^^xsd:decimal ;
    :hasNonWageIncome "2000.0"^^xsd:decimal 
    :hasIncorrectTaxCredits false .